#!/usr/bin/env python3
"""
Complete Clear Prospects WBS PMAX Asset Optimizer Pipeline
"""

import json
import sys
sys.path.insert(0, '.')

from convert_brightminds_api_to_csv import convert_api_to_csv
from analyse_api_export import analyse_bright_minds_api

# Clear Prospects WBS API data (21 text assets)
# Customer ID: 6281395727
# Campaign: CPL | WBS | P Max Shopping | H&S (17599480539)
# Date Range: Last 30 days

api_results_json = '''[{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"988","conversionsValue":601.743521028,"conversions":48.52695,"costMicros":"581688562","ctr":0.04956853301224162,"impressions":"19932"},"asset":{"resourceName":"customers/6281395727/assets/81186602564","type":"TEXT","textAsset":{"text":"Say Goodbye To Stress With Our Luxurious Wheat Bags - Soothing Relief To Help You Unwind"},"id":"81186602564"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~81186602564~DESCRIPTION","fieldType":"DESCRIPTION"}},{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"1023","conversionsValue":661.702875188,"conversions":51.607784,"costMicros":"598778000","ctr":0.05482315112540193,"impressions":"18660"},"asset":{"resourceName":"customers/6281395727/assets/37275241","type":"TEXT","textAsset":{"text":"The Wheat Bag Specialists"},"id":"37275241"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~37275241~HEADLINE","fieldType":"HEADLINE"}},{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"790","conversionsValue":462.72093209,"conversions":36.363881,"costMicros":"423513980","ctr":0.04426266248319139,"impressions":"17848"},"asset":{"resourceName":"customers/6281395727/assets/81187839149","type":"TEXT","textAsset":{"text":"Range Of Sizes For Back, Shoulders, Neck, Legs, Knees, Hands, Forehead & Eyes - View Now"},"id":"81187839149"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~81187839149~DESCRIPTION","fieldType":"DESCRIPTION"}},{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"407","conversionsValue":100.391613611,"conversions":8.025304,"costMicros":"48827118","ctr":0.02909636831569917,"impressions":"13988"},"asset":{"resourceName":"customers/6281395727/assets/14026117230","type":"TEXT","textAsset":{"text":"Safely Microwave In Minutes"},"id":"14026117230"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~14026117230~HEADLINE","fieldType":"HEADLINE"}},{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"400","conversionsValue":167.50161384,"conversions":11.025304,"costMicros":"74318788","ctr":0.03291097581043278,"impressions":"12154"},"asset":{"resourceName":"customers/6281395727/assets/81228131862","type":"TEXT","textAsset":{"text":"Say Goodbye to Discomfort: Let WheatyBags Bring Warmth and Relaxation into Your Life"},"id":"81228131862"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~81228131862~DESCRIPTION","fieldType":"DESCRIPTION"}},{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"541","conversionsValue":335.791646558,"conversions":26.513495,"costMicros":"306642641","ctr":0.049578445747800584,"impressions":"10912"},"asset":{"resourceName":"customers/6281395727/assets/16512543778","type":"TEXT","textAsset":{"text":"Microwave Heat Packs"},"id":"16512543778"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~16512543778~HEADLINE","fieldType":"HEADLINE"}},{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"382","conversionsValue":310.69625725,"conversions":22.038002,"costMicros":"226670960","ctr":0.04164849542084605,"impressions":"9172"},"asset":{"resourceName":"customers/6281395727/assets/81186602561","type":"TEXT","textAsset":{"text":"Incredible Wheat Bag Deals"},"id":"81186602561"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~81186602561~HEADLINE","fieldType":"HEADLINE"}},{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"326","conversionsValue":175.13682234,"conversions":14.889721,"costMicros":"198953020","ctr":0.05730356828968184,"impressions":"5689"},"asset":{"resourceName":"customers/6281395727/assets/81186602558","type":"TEXT","textAsset":{"text":"Big Range Of Sizes & Colours"},"id":"81186602558"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~81186602558~HEADLINE","fieldType":"HEADLINE"}},{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"290","conversionsValue":188.90215887,"conversions":12.464937,"costMicros":"196904681","ctr":0.05100246218782976,"impressions":"5686"},"asset":{"resourceName":"customers/6281395727/assets/39503932910","type":"TEXT","textAsset":{"text":"Wheat Bags & Hot Water Bottles"},"id":"39503932910"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~39503932910~HEADLINE","fieldType":"HEADLINE"}},{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"104","conversionsValue":82.477230868,"conversions":6.000757,"costMicros":"59659574","ctr":0.03372243839169909,"impressions":"3084"},"asset":{"resourceName":"customers/6281395727/assets/16606013952","type":"TEXT","textAsset":{"text":"Warm Soothing Comfort"},"id":"16606013952"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~16606013952~HEADLINE","fieldType":"HEADLINE"}},{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"104","conversionsValue":40.28,"conversions":3,"costMicros":"59090818","ctr":0.05287239450940519,"impressions":"1967"},"asset":{"resourceName":"customers/6281395727/assets/101805425575","type":"TEXT","textAsset":{"text":"Natural & Sustainable"},"id":"101805425575"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~101805425575~HEADLINE","fieldType":"HEADLINE"}},{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"62","conversionsValue":54.280968,"conversions":3.106138,"costMicros":"35852351","ctr":0.03870162297128589,"impressions":"1602"},"asset":{"resourceName":"customers/6281395727/assets/127852751178","type":"TEXT","textAsset":{"text":"View Our Range Of Affordable Wheat Bags - Eco Friendly Relief From Pain"},"id":"127852751178"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~127852751178~DESCRIPTION","fieldType":"DESCRIPTION"}},{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"65","conversionsValue":74.94,"conversions":6,"costMicros":"38840543","ctr":0.045839210155148094,"impressions":"1418"},"asset":{"resourceName":"customers/6281395727/assets/101805425581","type":"TEXT","textAsset":{"text":"Pure Comfort, Naturally"},"id":"101805425581"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~101805425581~HEADLINE","fieldType":"HEADLINE"}},{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"114","conversionsValue":230.769999348,"conversions":16,"costMicros":"79303048","ctr":0.09033280507131537,"impressions":"1262"},"asset":{"resourceName":"customers/6281395727/assets/81187839152","type":"TEXT","textAsset":{"text":"Get Soothing Relief With Our Premium Wheat Bags"},"id":"81187839152"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~81187839152~DESCRIPTION","fieldType":"DESCRIPTION"}},{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"52","conversionsValue":52.935,"conversions":4.5,"costMicros":"27866644","ctr":0.046058458813108945,"impressions":"1129"},"asset":{"resourceName":"customers/6281395727/assets/118382638111","type":"TEXT","textAsset":{"text":"Big Choice of Fabrics"},"id":"118382638111"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~118382638111~HEADLINE","fieldType":"HEADLINE"}},{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"44","conversionsValue":39.4484923,"conversions":3.498707,"costMicros":"29183396","ctr":0.04070305272895467,"impressions":"1081"},"asset":{"resourceName":"customers/6281395727/assets/101805425578","type":"TEXT","textAsset":{"text":"Eco-Friendly Relief"},"id":"101805425578"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~101805425578~HEADLINE","fieldType":"HEADLINE"}},{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"10","conversionsValue":0,"conversions":0,"costMicros":"5273162","ctr":0.01579778830963665,"impressions":"633"},"asset":{"resourceName":"customers/6281395727/assets/81187839149","type":"TEXT","textAsset":{"text":"Range Of Sizes For Back, Shoulders, Neck, Legs, Knees, Hands, Forehead & Eyes - View Now"},"id":"81187839149"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~81187839149~LONG_HEADLINE","fieldType":"LONG_HEADLINE"}},{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"0","conversionsValue":0,"conversions":0,"costMicros":"893846","ctr":0,"impressions":"288"},"asset":{"resourceName":"customers/6281395727/assets/81228131862","type":"TEXT","textAsset":{"text":"Say Goodbye to Discomfort: Let WheatyBags Bring Warmth and Relaxation into Your Life"},"id":"81228131862"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~81228131862~LONG_HEADLINE","fieldType":"LONG_HEADLINE"}},{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"2","conversionsValue":0,"conversions":0,"costMicros":"783399","ctr":0.008032128514056224,"impressions":"249"},"asset":{"resourceName":"customers/6281395727/assets/83690491101","type":"TEXT","textAsset":{"text":"Say Goodbye To Stress With Our Luxurious Wheat Bags - Great Quality At An Affordable Price"},"id":"83690491101"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~83690491101~LONG_HEADLINE","fieldType":"LONG_HEADLINE"}},{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"0","conversionsValue":0,"conversions":0,"costMicros":"624554","ctr":0,"impressions":"226"},"asset":{"resourceName":"customers/6281395727/assets/127852751178","type":"TEXT","textAsset":{"text":"View Our Range Of Affordable Wheat Bags - Eco Friendly Relief From Pain"},"id":"127852751178"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~127852751178~LONG_HEADLINE","fieldType":"LONG_HEADLINE"}},{"campaign":{"resourceName":"customers/6281395727/campaigns/17599480539","name":"CPL | WBS | P Max Shopping | H&S 120 4/9","id":"17599480539"},"metrics":{"clicks":"1","conversionsValue":0,"conversions":0,"costMicros":"891587","ctr":0.0045871559633027525,"impressions":"218"},"asset":{"resourceName":"customers/6281395727/assets/81228131856","type":"TEXT","textAsset":{"text":"Get Soothing Relief With Our Premium Wheat Bags – Perfect for Aches, Pains & Relaxation"},"id":"81228131856"},"assetGroup":{"resourceName":"customers/6281395727/assetGroups/6448689100","name":"WBS Search & Shopping","id":"6448689100"},"assetGroupAsset":{"resourceName":"customers/6281395727/assetGroupAssets/6448689100~81228131856~LONG_HEADLINE","fieldType":"LONG_HEADLINE"}}]'''

api_results = json.loads(api_results_json)

# Pipeline execution
print("=" * 80)
print("CLEAR PROSPECTS WBS - PMAX ASSET OPTIMIZER")
print("=" * 80)
print()
print(f"✅ Step 1: API Export (21 assets loaded)")
print()

# Step 2: Convert to CSV
print("⏳ Step 2: Converting to CSV...")
csv_output = "output/clearprospects-wbs-asset-performance-api-2025-11-27.csv"
convert_api_to_csv(api_results, csv_output)
print()

# Step 3: Analyze with customer-specific benchmarks
print("⏳ Step 3: Analyzing with customer-specific benchmarks...")
classifications, benchmarks = analyse_bright_minds_api(api_results)
print()

print("=" * 80)
print("PIPELINE COMPLETE")
print("=" * 80)
print()
print("Next steps:")
if classifications['REPLACE']['HIGH'] or classifications['REPLACE']['MEDIUM']:
    print(f"✅ Ready for replacement text generation!")
    print(f"   HIGH priority: {len(classifications['REPLACE']['HIGH'])} assets")
    print(f"   MEDIUM priority: {len(classifications['REPLACE']['MEDIUM'])} assets")
    print()
    print("Run: python3 generate_replacement_text.py --customer-id 6281395727 --csv output/clearprospects-wbs-asset-performance-api-2025-11-27.csv")
else:
    print("❌ No underperformers found - all assets performing well")
