# YouTube MCP Server

Model Context Protocol (MCP) server for accessing YouTube video metadata and transcripts.

## Features

- **Get video metadata**: Title, channel, description, publish date, tags, statistics
- **Extract transcripts**: Full video transcripts (both manual and auto-generated captions)
- Supports multiple languages
- Automatic video ID extraction from URLs

## Tools

### `get_video_info(video_url)`

Fetch comprehensive metadata for a YouTube video.

**Parameters:**
- `video_url` (str): YouTube video URL or video ID

**Returns:**
- `videoId`: Video ID
- `url`: Full YouTube URL
- `title`: Video title
- `channelTitle`: Channel name
- `channelId`: Channel ID
- `description`: Full video description
- `publishedAt`: Publication date (ISO format)
- `tags`: List of video tags
- `categoryId`: Category ID
- `duration`: Video duration (ISO 8601 format)
- `viewCount`: Number of views
- `likeCount`: Number of likes
- `commentCount`: Number of comments
- `thumbnails`: Dictionary of thumbnail URLs

**Example:**
```python
mcp__youtube__get_video_info("https://www.youtube.com/watch?v=YFYwZ-kG_5U")
```

### `get_transcript(video_url, languages=None)`

Extract transcript/captions from a YouTube video.

**Parameters:**
- `video_url` (str): YouTube video URL or video ID
- `languages` (list, optional): List of language codes to try (default: `['en']`)

**Returns:**
- `videoId`: Video ID
- `url`: Full YouTube URL
- `language`: Language code of the transcript
- `isAutoGenerated`: Whether transcript is auto-generated (boolean)
- `fullText`: Complete transcript as single string
- `segments`: List of transcript segments with timestamps
- `segmentCount`: Number of segments
- `wordCount`: Total word count

**Example:**
```python
# English transcript (default)
mcp__youtube__get_transcript("https://www.youtube.com/watch?v=YFYwZ-kG_5U")

# Try multiple languages
mcp__youtube__get_transcript("YFYwZ-kG_5U", languages=['en', 'en-GB', 'en-US'])
```

## Setup

### 1. Install Dependencies

```bash
cd infrastructure/mcp-servers/youtube-mcp-server
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

### 2. Get YouTube Data API Key

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Create a new project or select existing project
3. Enable **YouTube Data API v3**:
   - Go to "APIs & Services" > "Library"
   - Search for "YouTube Data API v3"
   - Click "Enable"
4. Create API credentials:
   - Go to "APIs & Services" > "Credentials"
   - Click "Create Credentials" > "API Key"
   - Copy the API key
5. (Optional) Restrict the API key:
   - Click on the API key
   - Under "API restrictions", select "Restrict key"
   - Choose "YouTube Data API v3"
   - Save

### 3. Configure Environment Variables

Create `.env` file:

```bash
cp .env.example .env
```

Edit `.env` and add your API key:

```
YOUTUBE_API_KEY=YOUR_API_KEY_HERE
```

### 4. Add to Claude Code MCP Configuration

Add to `.mcp.json`:

```json
{
  "mcpServers": {
    "youtube": {
      "command": "/Users/administrator/Documents/PetesBrain.nosync/infrastructure/mcp-servers/youtube-mcp-server/.venv/bin/python",
      "args": [
        "/Users/administrator/Documents/PetesBrain.nosync/infrastructure/mcp-servers/youtube-mcp-server/server.py"
      ],
      "env": {
        "YOUTUBE_API_KEY": "YOUR_API_KEY_HERE"
      }
    }
  }
}
```

**Or use the `claude mcp add` command:**

```bash
claude mcp add -s user youtube \
  "/Users/administrator/Documents/PetesBrain.nosync/infrastructure/mcp-servers/youtube-mcp-server/.venv/bin/python" \
  "/Users/administrator/Documents/PetesBrain.nosync/infrastructure/mcp-servers/youtube-mcp-server/server.py"
```

Then manually add the `YOUTUBE_API_KEY` to the `env` section in `.mcp.json`.

### 5. Test

```python
# Test video info
result = mcp__youtube__get_video_info("https://www.youtube.com/watch?v=YFYwZ-kG_5U")
print(result['title'])

# Test transcript
transcript = mcp__youtube__get_transcript("YFYwZ-kG_5U")
print(transcript['fullText'][:500])  # First 500 characters
```

## URL Formats Supported

The tools accept multiple URL formats:

- Full URL: `https://www.youtube.com/watch?v=YFYwZ-kG_5U`
- Short URL: `https://youtu.be/YFYwZ-kG_5U`
- Video ID: `YFYwZ-kG_5U`

## Transcript Notes

- Transcripts can be manually created or auto-generated
- Auto-generated transcripts may have accuracy issues
- Not all videos have transcripts available
- If no transcript exists in requested language, tool will try any available language
- Returns error if no transcripts are available at all

## API Quotas

YouTube Data API v3 has daily quota limits:

- **Default quota**: 10,000 units/day
- **get_video_info**: 1 unit per call
- **get_transcript**: 0 units (uses youtube-transcript-api, no quota usage)

If you exceed quota, requests will fail with quota error. You can request quota increase in Google Cloud Console.

## Error Handling

**Common errors:**

- `YOUTUBE_API_KEY not found`: Add API key to `.env` or `.mcp.json`
- `Video not found`: Invalid video ID or video is private/deleted
- `Transcripts are disabled`: Video owner disabled captions
- `No transcript found in languages`: Try different language codes or omit language parameter
- `Video is unavailable`: Video is private, deleted, or region-restricted
- Quota exceeded: Wait 24 hours or request quota increase

## Integration with Knowledge Base

To add YouTube videos to knowledge base, use this workflow:

```python
# 1. Get video metadata
info = mcp__youtube__get_video_info(video_url)

# 2. Get transcript
transcript = mcp__youtube__get_transcript(video_url)

# 3. Use kb-add-article skill to add to knowledge base
# It will extract:
# - Title from info['title']
# - Channel/Author from info['channelTitle']
# - Published date from info['publishedAt']
# - Content from transcript['fullText']
```

## License

Part of the PetesBrain automation system.
